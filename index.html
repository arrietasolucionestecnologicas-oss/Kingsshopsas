<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>King's Shop App V65</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #000000; --gold: #d4af37; --light: #f8f9fa; --dark: #212529; }
        body { font-family: 'Poppins', sans-serif; background-color: #f0f2f5; padding-bottom: 80px; user-select: none; }
        
        /* HEADER */
        .app-header { background: var(--primary); color: var(--gold); padding: 15px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; }
        .app-logo { font-weight: 700; font-size: 1.2rem; letter-spacing: 1px; }
        .user-badge { font-size: 0.8rem; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 20px; }

        /* CARDS */
        .card-k { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .card-stat { text-align: center; padding: 20px; background: linear-gradient(145deg, #ffffff, #f0f0f0); }
        .stat-val { font-size: 1.5rem; font-weight: 700; color: var(--dark); }
        .stat-label { font-size: 0.8rem; color: #6c757d; text-transform: uppercase; letter-spacing: 1px; }

        /* CATALOGO */
        .card-catalog { display: flex; align-items: center; background: white; border-radius: 12px; padding: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .cat-img-box { width: 70px; height: 70px; border-radius: 10px; overflow: hidden; background: #eee; flex-shrink: 0; display: flex; align-items: center; justify-content: center; position: relative; }
        .cat-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .cat-body { flex-grow: 1; padding-left: 15px; min-width: 0; }
        .cat-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .cat-price { color: var(--gold); font-weight: 700; font-size: 1rem; }
        .cat-actions { display: flex; gap: 5px; flex-shrink: 0; }
        .btn-copy-mini { font-size: 0.7rem; padding: 5px 8px; background: #eee; border-radius: 5px; cursor: pointer; color: #555; }
        .btn-copy-mini:active { background: var(--gold); color: white; }
        .btn-edit-float { position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.5); color: white; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; border-bottom-left-radius: 10px; cursor: pointer; font-size: 0.7rem; }

        /* POS */
        .pos-row-lite { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .pos-row-lite:last-child { border-bottom: none; }
        .pos-row-lite:hover { background: #f9f9f9; }
        .pos-row-lite.active { background: #fff8e1; border-left: 4px solid var(--gold); }
        .pos-row-lite .info { flex-grow: 1; }
        .pos-row-lite .name { font-weight: 600; font-size: 0.9rem; }
        .pos-row-lite .meta { font-size: 0.75rem; color: #888; }
        .pos-row-lite .price { font-weight: 700; color: var(--dark); }

        /* AUDITORIA (NUEVO ESTILO) */
        .audit-box { border: 2px dashed #ccc; background: #fdfdfd; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
        .audit-box.safe { border-color: green; background: #e8f5e9; }
        .audit-box.danger { border-color: red; background: #ffebee; }
        .audit-big-num { font-size: 2rem; font-weight: bold; margin: 10px 0; }
        
        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-btn { text-align: center; color: #aaa; font-size: 0.75rem; background: none; border: none; flex: 1; transition: 0.3s; }
        .nav-btn i { font-size: 1.4rem; display: block; margin-bottom: 2px; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn.active i { color: var(--gold); }

        /* FLOATING CART */
        .btn-float-cart { position: fixed; bottom: 90px; right: 20px; background: var(--primary); color: var(--gold); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 900; border: 2px solid var(--gold); cursor: pointer; display: none; animation: popIn 0.3s; }
        @keyframes popIn { from{transform:scale(0);} to{transform:scale(1);} }

        /* UTILS */
        .hidden { display: none !important; }
        .form-control:focus { border-color: var(--gold); box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25); }
        .btn-gold { background: var(--gold); color: black; font-weight: 700; border: none; }
        .btn-gold:hover { background: #b59020; }
        
        /* MOBILE CART DRAWER */
        .cart-drawer { position: fixed; top: 0; right: -100%; width: 100%; height: 100%; background: #f8f9fa; z-index: 2000; transition: 0.3s; padding: 20px; overflow-y: auto; max-width: 500px; display: flex; flex-direction: column; }
        .cart-drawer.visible { right: 0; }

        /* OFFLINE INDICATOR */
        #offline-indicator { background: #dc3545; color: white; text-align: center; padding: 5px; font-size: 0.8rem; display: none; }
        
        /* MODAL FULLSCREEN */
        .modal-fullscreen .modal-dialog { width: 100%; height: 100%; margin: 0; padding: 0; max-width: none; }
        .modal-fullscreen .modal-content { height: 100%; border: 0; border-radius: 0; }

        .btn-wa-mini { background: #25D366; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 0.9rem; }
        
        /* DEBT CARD */
        .card-debt { border-left: 4px solid #dc3545; }
        .badge-debt { background: #dc3545; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div id="offline-indicator">丘멆잺 MODO OFFLINE - Cambios se guardar치n localmente</div>

    <div class="app-header">
        <div class="app-logo"><i class="fas fa-crown"></i> KING'S SHOP</div>
        <div class="user-badge" id="user-display">Cargando...</div>
    </div>

    <div id="view-pos" class="view-sec container mt-3">
        <div class="card-k p-2 mb-2">
            <div class="input-group">
                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search"></i></span>
                <input type="text" id="pos-search" class="form-control border-start-0" placeholder="Buscar producto..." onkeyup="renderPos()">
            </div>
        </div>

        <div id="pos-list" class="pb-5"></div>
        <div id="pos-placeholder" class="text-center text-muted mt-5">
            <i class="fas fa-barcode fa-3x mb-3 opacity-25"></i>
            <p>Usa el buscador o presiona la calculadora para venta libre.</p>
            <button class="btn btn-outline-dark btn-sm" onclick="openFreeCalculator()">Calculadora Libre</button>
        </div>
    </div>

    <div id="view-inv" class="view-sec container mt-3" style="display:none;">
        <div class="row g-2 mb-3">
            <div class="col-8">
                <input type="text" id="inv-search" class="form-control" placeholder="Filtrar cat치logo..." onkeyup="renderInv()">
            </div>
            <div class="col-4">
                <select id="filter-prov" class="form-select" onchange="renderInv()">
                    <option value="">Todos</option>
                </select>
            </div>
        </div>

        <div id="inv-list" class="pb-5"></div>
        
        <div style="position:fixed; bottom:90px; left:20px; z-index:900;">
             <button class="btn btn-dark rounded-circle shadow" style="width:50px; height:50px;" onclick="abrirModalNuevo()">
                 <i class="fas fa-plus"></i>
             </button>
             <button class="btn btn-secondary rounded-circle shadow ms-2" style="width:50px; height:50px;" onclick="abrirModalWA()">
                 <i class="fas fa-magic"></i>
             </button>
        </div>
    </div>
    
    <div id="view-web" class="view-sec container mt-3" style="display:none;">
        <div class="card-k bg-dark text-white mb-3">
            <h4><i class="fas fa-globe"></i> Gesti칩n Web</h4>
            <p class="small opacity-75">Activa o desactiva productos en la p치gina p칰blica.</p>
        </div>
        <div class="card-k p-2 mb-2">
            <input type="text" id="web-search" class="form-control" placeholder="Buscar en web..." onkeyup="renderWeb()">
        </div>
        <div id="web-list" class="pb-5"></div>
    </div>

    <div id="view-fin" class="view-sec container mt-3" style="display:none;">
        
        <div class="card-k border-top border-4 border-warning">
            <h5 class="fw-bold mb-3"><i class="fas fa-balance-scale"></i> AUDITOR칈A DE CAJA</h5>
            <p class="small text-muted mb-3">Escribe cu치nto dinero real tienes (Bancos + Efectivo) y verifica contra el sistema.</p>
            
            <div class="input-group mb-3">
                <span class="input-group-text">$</span>
                <input type="number" id="audit-real-money" class="form-control form-control-lg fw-bold" placeholder="Dinero F칤sico Real">
                <button class="btn btn-dark" onclick="auditarCaja()">
                    <i class="fas fa-sync-alt"></i> VERIFICAR
                </button>
            </div>
            
            <div id="audit-result" style="display:none;" class="audit-box mt-3">
                <small class="text-uppercase fw-bold text-muted">Resultado del An치lisis</small>
                <div id="audit-msg" class="my-2"></div>
                
                <div class="row mt-3">
                    <div class="col-6 border-end">
                        <small>Sistema Dice:</small>
                        <div class="fw-bold text-primary" id="audit-sys-val">$0</div>
                    </div>
                    <div class="col-6">
                        <small>T칰 Tienes:</small>
                        <div class="fw-bold text-dark" id="audit-usr-val">$0</div>
                    </div>
                </div>

                <div id="audit-actions" class="mt-3 pt-3 border-top" style="display:none;">
                    <p class="small text-danger fw-bold">丘멆잺 Hay un desfase. 쯈uieres corregirlo?</p>
                    <button class="btn btn-outline-danger w-100" onclick="nivelarCaja()">
                        <i class="fas fa-wrench"></i> AJUSTAR AUTOM츼TICAMENTE
                    </button>
                    <small class="d-block mt-1 text-muted fst-italic">Esto crear치 un movimiento de ajuste para igualar los saldos.</small>
                </div>
            </div>
        </div>

        <h6 class="fw-bold mt-4 mb-2 ps-2">칔LTIMOS MOVIMIENTOS</h6>
        <div id="hist-list" class="pb-5"></div>

        <div style="position:fixed; bottom:90px; right:20px; display:flex; flex-direction:column; gap:10px; z-index:900;">
            <button class="btn btn-success rounded-circle shadow" style="width:50px; height:50px;" data-bs-toggle="modal" data-bs-target="#modalIngreso">
                <i class="fas fa-arrow-down"></i>
            </button>
            <button class="btn btn-danger rounded-circle shadow" style="width:50px; height:50px;" data-bs-toggle="modal" data-bs-target="#modalGasto">
                <i class="fas fa-arrow-up"></i>
            </button>
        </div>
    </div>

    <div id="view-ped" class="view-sec container mt-3" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="m-0 fw-bold">Pedidos</h4>
            <button class="btn btn-dark btn-sm" onclick="abrirModalPed()">+ Nuevo</button>
        </div>
        <div id="ped-list" class="pb-5"></div>
    </div>

    <div id="view-cart" class="view-sec container mt-3" style="display:none;">
         <div class="card-k bg-danger text-white mb-3">
             <div class="d-flex justify-content-between align-items-center">
                 <div>
                     <h2 class="m-0 fw-bold" id="bal-cartera">$0</h2>
                     <small>Total por Cobrar</small>
                 </div>
                 <i class="fas fa-hand-holding-usd fa-2x opacity-50"></i>
             </div>
         </div>
         <div id="cartera-list" class="pb-5"></div>
         <button class="btn btn-primary rounded-circle shadow" style="width:60px; height:60px; position:fixed; bottom:90px; right:20px; font-size:1.5rem; z-index:900;" data-bs-toggle="modal" data-bs-target="#modalAbono">
             <i class="fas fa-handshake"></i>
         </button>
    </div>

    <div id="view-prov" class="view-sec container mt-3" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-bold">Proveedores</h4>
            <button class="btn btn-dark btn-sm" onclick="abrirModalProv()">+ Nuevo</button>
        </div>
        <div id="list-provs" class="pb-5"></div>
    </div>

    <div id="btn-float-cart" class="btn-float-cart" onclick="toggleMobileCart()">游 0</div>

    <div id="mobile-cart" class="cart-drawer shadow-lg">
        <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
            <h5 class="fw-bold m-0"><i class="fas fa-cash-register"></i> PUNTO DE VENTA</h5>
            <button class="btn-close" onclick="toggleMobileCart()"></button>
        </div>

        <div id="tpl-cart" style="display:none;">
            <div class="mb-3">
                <label class="small fw-bold text-muted">CLIENTE</label>
                <input type="text" id="c-cliente" class="form-control form-control-lg fw-bold" placeholder="Nombre del cliente...">
            </div>

            <div class="card p-2 bg-light border-0 mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold text-muted">PRODUCTOS</span>
                    <span class="badge bg-secondary cursor-pointer" onclick="clearCart()">Limpiar</span>
                </div>
                <div id="cart-items-list" class="mt-2 small text-muted fst-italic border-start border-3 border-warning ps-2">
                    </div>
                <div class="mt-2">
                    <label class="small text-muted">Concepto Manual (Si no hay productos)</label>
                    <input type="text" id="c-concepto" class="form-control form-control-sm" placeholder="Ej: Venta Varios...">
                </div>
            </div>

            <div class="row g-2 mb-3">
                <div class="col-6">
                    <label class="small fw-bold text-muted">M칄TODO</label>
                    <select id="c-metodo" class="form-select fw-bold" onchange="calcCart()">
                        <option value="Contado">Contado</option>
                        <option value="Cr칠dito">Cr칠dito</option>
                    </select>
                </div>
                <div class="col-6">
                    <label class="small fw-bold text-muted">FECHA VENTA</label>
                    <input type="date" id="c-fecha" class="form-control text-center" style="font-size:0.9rem;">
                </div>
            </div>

            <div class="card p-3 border-gold mb-3 bg-white shadow-sm">
                <div class="d-flex justify-content-between mb-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="c-manual" onchange="toggleManual()">
                        <label class="form-check-label small" for="c-manual">Precio Manual</label>
                    </div>
                    <div class="form-check form-switch">
                         <input class="form-check-input" type="checkbox" id="c-iva" onchange="calcCart()">
                         <label class="form-check-label small" for="c-iva">+IVA (19%)</label>
                    </div>
                </div>

                <div class="text-center mb-3">
                    <small class="text-muted d-block text-uppercase ls-1">Total a Cobrar</small>
                    <div id="res-cont" class="display-4 fw-bold text-dark">$0</div>
                    <input type="number" id="res-cont-input" class="form-control form-control-lg text-center fw-bold fs-2" style="display:none;" placeholder="0" onkeyup="calcCart()">
                </div>
                
                <div class="row g-2 mb-2 align-items-end">
                    <div class="col-4">
                        <label class="small text-muted" style="font-size:0.7rem;">% UTILIDAD</label>
                        <input type="number" id="c-util" class="form-control text-center bg-light" value="30" onkeyup="calcCart()">
                    </div>
                    <div class="col-4">
                         <label class="small text-muted" style="font-size:0.7rem;">TARGET ($)</label>
                         <input type="number" id="c-target" class="form-control text-center bg-light" placeholder="Fijar" onkeyup="calcCart()">
                    </div>
                    <div class="col-4">
                        <label class="small text-muted" style="font-size:0.7rem;">% INTER칄S</label>
                        <input type="number" id="c-int" class="form-control text-center bg-light" value="10" onkeyup="calcCart()">
                    </div>
                </div>

                <div id="row-cred" style="display:none;" class="mt-3 pt-3 border-top">
                    <div class="row g-2 align-items-center mb-2">
                        <div class="col-4 text-end"><small class="fw-bold">INICIAL:</small></div>
                        <div class="col-8">
                            <input type="number" id="c-inicial" class="form-control fw-bold text-primary" placeholder="Monto Inicial" onkeyup="calcCart()">
                            <small class="text-muted" id="res-ini" style="display:none;">$0</small>
                        </div>
                    </div>
                    <div class="row g-2 align-items-center">
                        <div class="col-4 text-end"><small class="fw-bold">CUOTAS:</small></div>
                        <div class="col-4">
                            <input type="number" id="c-cuotas" class="form-control text-center" value="1" onkeyup="calcCart()">
                        </div>
                        <div class="col-4 text-center">
                            <div class="fw-bold text-danger" id="res-cuota-val">$0</div>
                            <small class="text-muted" id="res-cuota-txt" style="font-size:0.7rem;">x1</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-dark btn-lg" onclick="finalizarVenta()">
                    <i class="fas fa-check-circle"></i> GUARDAR VENTA
                </button>
                <button class="btn btn-outline-success" onclick="shareQuote()">
                    <i class="fab fa-whatsapp"></i> COTIZAR
                </button>
            </div>
        </div>
        
        <div id="desktop-cart-container"></div>

    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" onclick="nav('pos', this)">
            <i class="fas fa-calculator"></i>POS
        </button>
        <button class="nav-btn" onclick="nav('inv', this)">
            <i class="fas fa-boxes"></i>Inv.
        </button>
        <button class="nav-btn" onclick="nav('web', this)">
            <i class="fas fa-globe"></i>Web
        </button>
        <button class="nav-btn" onclick="nav('fin', this)">
            <i class="fas fa-chart-pie"></i>Balance
        </button>
        <button class="nav-btn" onclick="nav('cart', this)">
            <i class="fas fa-wallet"></i>Cartera
        </button>
        <button class="nav-btn" onclick="nav('ped', this)">
            <i class="fas fa-truck-loading"></i>Pedidos
        </button>
        <button class="nav-btn" onclick="nav('prov', this)">
            <i class="fas fa-users"></i>Prov.
        </button>
    </div>

    <div class="modal fade" id="modalEdicion" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content bg-light">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Editar Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="card p-3 mb-3">
                        <label class="small text-muted">Nombre</label>
                        <input type="text" id="inp-edit-nombre" class="form-control mb-2 fw-bold">
                        
                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <label class="small text-muted">Categor칤a</label>
                                <input type="text" id="inp-edit-categoria" class="form-control" list="list-cats">
                            </div>
                            <div class="col-6">
                                <label class="small text-muted">Proveedor</label>
                                <input type="text" id="inp-edit-proveedor" class="form-control">
                            </div>
                        </div>

                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <label class="small text-muted">Costo</label>
                                <input type="number" id="inp-edit-costo" class="form-control" onkeyup="calcGain('inp-edit-costo','inp-edit-publico')">
                            </div>
                            <div class="col-6">
                                <label class="small text-muted">P칰blico</label>
                                <input type="number" id="inp-edit-publico" class="form-control fw-bold text-success">
                            </div>
                        </div>
                        
                        <label class="small text-muted">Descripci칩n</label>
                        <textarea id="inp-edit-desc" class="form-control mb-3" rows="3"></textarea>
                        
                        <label class="small text-muted">Foto (Opcional)</label>
                        <input type="file" id="inp-file-foto" class="form-control mb-2" accept="image/*" onchange="previewFile()">
                        <img id="img-preview-box" src="" style="width:100px; height:100px; object-fit:cover; display:none; border-radius:10px;">
                    </div>
                    
                    <div class="card p-3 border-primary">
                        <h6 class="text-primary fw-bold"><i class="fas fa-globe"></i> Configuraci칩n Web</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="inp-edit-web">
                            <label class="form-check-label" for="inp-edit-web">Mostrar en P치gina Web</label>
                        </div>
                        <label class="small text-muted">Categor칤a Web</label>
                        <select id="inp-edit-cat-web" class="form-select">
                            <option value="tecnologia">Tecnolog칤a</option>
                            <option value="electro">Hogar / Electro</option>
                            <option value="Gadget y Novedades">Gadget y Novedades</option>
                            <option value="juguetes">Juguetes</option>
                            <option value="perfumes">Perfumes</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger me-auto" onclick="eliminarProductoActual()">Eliminar</button>
                    <button type="button" class="btn btn-gold" onclick="guardarCambiosAvanzado()">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="modalNuevo" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content bg-light">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Nuevo Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="card p-3 mb-3">
                         <div class="input-group mb-2">
                             <input type="text" id="new-id" class="form-control" placeholder="ID (Auto si vac칤o)">
                             <button class="btn btn-outline-secondary" onclick="generarIDAuto()">Auto</button>
                         </div>
                         <input type="text" id="new-nombre" class="form-control mb-2" placeholder="Nombre Producto">
                         
                         <div class="row g-2 mb-2">
                             <div class="col-6"><input type="text" id="new-categoria" class="form-control" list="list-cats" placeholder="Categor칤a"></div>
                             <div class="col-6"><input type="text" id="new-proveedor" class="form-control" placeholder="Proveedor"></div>
                         </div>
                         <div class="row g-2 mb-2">
                             <div class="col-6"><input type="number" id="new-costo" class="form-control" placeholder="Costo" onkeyup="calcGain('new-costo','new-publico')"></div>
                             <div class="col-6"><input type="number" id="new-publico" class="form-control fw-bold" placeholder="P칰blico"></div>
                         </div>
                         <textarea id="new-desc" class="form-control mb-3" rows="3" placeholder="Descripci칩n..."></textarea>
                         <input type="file" id="new-file-foto" class="form-control" accept="image/*">
                    </div>

                    <div class="card p-3 border-primary">
                        <h6 class="text-primary fw-bold"><i class="fas fa-globe"></i> Configuraci칩n Web</h6>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="new-web" checked>
                            <label class="form-check-label" for="new-web">Publicar en Web al guardar</label>
                        </div>
                        <select id="new-cat-web" class="form-select">
                            <option value="tecnologia">Tecnolog칤a</option>
                            <option value="electro">Hogar / Electro</option>
                            <option value="Gadget y Novedades">Gadget y Novedades</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-gold w-100" onclick="crearProducto()">Crear Producto</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAbono" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Registrar Abono</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <select id="ab-cli" class="form-select mb-3"></select>
                    <input type="number" id="ab-monto" class="form-control mb-3 fw-bold fs-3 text-center" placeholder="$0">
                    <label class="small text-muted">Fecha Abono</label>
                    <input type="date" id="ab-fecha" class="form-control text-center mb-3">
                    <button class="btn btn-dark w-100 btn-lg" onclick="doAbono()">REGISTRAR</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalGasto" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Registrar Gasto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="g-desc" class="form-control mb-2" placeholder="Descripci칩n del gasto...">
                    <select id="g-cat" class="form-select mb-2">
                        <option value="General">General</option>
                        <option value="Transporte">Transporte</option>
                        <option value="Comida">Comida</option>
                        <option value="Servicios">Servicios</option>
                        <option value="N칩mina">N칩mina</option>
                    </select>
                    <label class="small text-muted">Vincular a Venta (Opcional)</label>
                    <select id="g-vinculo" class="form-select mb-3 text-muted" style="font-size:0.85rem;">
                         <option value="">-- Ninguna --</option>
                    </select>
                    <input type="number" id="g-monto" class="form-control mb-3 fw-bold fs-3 text-center" placeholder="$0">
                    <button class="btn btn-danger w-100 btn-lg" onclick="doGasto()">REGISTRAR SALIDA</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalIngreso" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Ingreso Extra</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted">Dinero que entra pero NO es venta de productos.</p>
                    <input type="text" id="inc-desc" class="form-control mb-2" placeholder="Motivo (Ej: Pr칠stamo, Aporte)...">
                    <select id="inc-cat" class="form-select mb-3">
                        <option value="Capital">Inyecci칩n Capital</option>
                        <option value="Prestamo">Pr칠stamo</option>
                        <option value="Otro">Otro</option>
                    </select>
                    <input type="number" id="inc-monto" class="form-control mb-3 fw-bold fs-3 text-center" placeholder="$0">
                    <button class="btn btn-success w-100 btn-lg" onclick="doIngresoExtra()">REGISTRAR ENTRADA</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="modalWA" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">Importar de WhatsApp</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted">Pega el texto de la lista de precios de WhatsApp:</p>
                    <textarea id="wa-text" class="form-control mb-2" rows="5" placeholder="Ej: AUDIFONOS $20.000..."></textarea>
                    <div class="row g-2 mb-3">
                        <div class="col-6"><input type="text" id="wa-cat" class="form-control" placeholder="Categor칤a (Ej: Tecnolog칤a)"></div>
                        <div class="col-6"><input type="text" id="wa-prov" class="form-control" placeholder="Proveedor (Opcional)"></div>
                    </div>
                    <button class="btn btn-secondary w-100" onclick="procesarWA()">PROCESAR</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="modalPed" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Nuevo Pedido</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="pe-prod" class="form-control mb-2" placeholder="Producto a pedir..." list="list-prods-all">
                    <input type="text" id="pe-prov" class="form-control mb-2" placeholder="Proveedor...">
                    <input type="number" id="pe-costo" class="form-control mb-2" placeholder="Costo Estimado (Opcional)">
                    <textarea id="pe-nota" class="form-control mb-3" rows="2" placeholder="Notas..."></textarea>
                    <button class="btn btn-dark w-100" onclick="savePed()">GUARDAR PEDIDO</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="modalEditPed" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">Editar Pedido</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="small text-muted">Producto</label>
                    <input type="text" id="ed-ped-prod" class="form-control mb-2">
                    <label class="small text-muted">Proveedor</label>
                    <input type="text" id="ed-ped-prov" class="form-control mb-2">
                    <label class="small text-muted">Costo Estimado</label>
                    <input type="number" id="ed-ped-costo" class="form-control mb-2">
                    <label class="small text-muted">Notas</label>
                    <textarea id="ed-ped-nota" class="form-control mb-3" rows="2"></textarea>
                    <button class="btn btn-secondary w-100" onclick="guardarEdicionPed()">ACTUALIZAR</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEditMov" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title text-dark">Corregir Movimiento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-danger fw-bold">丘멆잺 Est치s editando el historial contable.</p>
                    <label class="small text-muted">Descripci칩n (Solo lectura)</label>
                    <input type="text" id="ed-mov-desc" class="form-control mb-2 bg-light" readonly>
                    
                    <label class="small text-muted">Fecha</label>
                    <input type="date" id="ed-mov-fecha" class="form-control mb-2">
                    
                    <label class="small text-muted">Monto Correcto</label>
                    <input type="number" id="ed-mov-monto" class="form-control mb-3 fw-bold">
                    
                    <button class="btn btn-dark w-100" onclick="guardarEdicionMovimiento()">GUARDAR CORRECCI칍N</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalProv" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Nuevo Proveedor</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="new-prov-name" class="form-control mb-2" placeholder="Nombre Empresa / Persona">
                    <input type="tel" id="new-prov-tel" class="form-control mb-3" placeholder="Celular (WhatsApp)">
                    <button class="btn btn-gold w-100" onclick="guardarProvManual()">GUARDAR</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 10000;"></div>
    
    <div id="loader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:9999; display:none; flex-direction:column; align-items:center; justify-content:center;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <h5 class="mt-3 text-muted fw-light blink">Procesando...</h5>
    </div>
    
    <datalist id="list-cats"></datalist>
    <datalist id="list-prods-all"></datalist>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="app.js?v=65"></script>
</body>
</html>
